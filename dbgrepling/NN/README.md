## Generating the suffix array

To generate the suffix array, please run:

```
g++ -o sampleSa sampleSa.cpp

suffixarray/refToSuffixArray <fasta>; eval/SuffixArraySample/sampleSa <fasta>.ref <fasta>.ref.sa;
```

We then need to sort the suffix array into lexicographic order, so run the following:

```
sort -k2,2 -k1n,1 <fasta>.ref.sa -o <fasta>.ref.sorted.sa
```

## Processing the suffix array
To process the sorted suffix array file (sa) before using any of the python files, please run the following:

```
cat sa | awk '{print $2}' | sed s/'A'/'00'/g | sed s/'C'/'01'/g | sed s/'G'/'10'/g | sed s/'T'/'11'/g > sa.bin
```
```
(echo 'obase=10;ibase=2;'; cat sa.bin) | bc | awk '{print $1, NR}' > sa.key.row
```

This `sa.key.row` can now be passed into preprocess.py.

## Generating Suffix Array numpy files

To generate the numpy arrays used for training and testing, please run:

```
python preprocess.py -f </path/to/sa.key.row> -d </path/to/preprocessed/SA/>
```

More details can be found in `preprocess.py`.

## Training Neural Nets

To train a simple neural net on bin 1 out of 1000 for the preprocessed suffix array, please run:

```
python3 fit.py -s 8 -l 1 -c 20 -x 1000 -y 1 -d /Users/user/NN/ -f /Users/user/SuffixArray/ 
```

Here, `/Users/user/NN/` is the folder where the model and plots are saved, and `/Users/user/SuffixArray/` is the folder where the files generated by `preprocess.py` are saved.

## Testing Neural Nets

To test the neural net trained above, please run:

```
python3 test.py -s 8 -l 1 -c 20 -x 1000 -y 1 -d /Users/user/NN/ -f /Users/user/SuffixArray/
```

## Running Training and Testing in batches

If you want to train all 1000 models in one call, please run this:

```
for i in {1..1000}; do echo "Working on model $i"; python3 fit.py -s 8 -l 1 -c 20 -x 1000 -y ${i} -d /Users/user/NN/ -f /Users/user/SuffixArray/;done
```

If you want to test all 1000 models in one call, please run this:
```
for i in {1..1000}; do echo "Working on model $i"; python3 test.py -s 8 -l 1 -c 20 -x 1000 -y ${i} -d /Users/user/NN/ -f /Users/user/SuffixArray/;done
```
